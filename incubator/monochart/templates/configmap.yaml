{{- $root := . -}}
{{- $name, $config = range .Values.configMaps }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "common.fullname" $root }}-{{ $name }}
  labels:
{{ include "common.labels.standard" $root | indent 4 }}
{{- if not ( empty $config.labels) }}
{{ toYaml $config.labels | indent 4 }}
{{- end }}
data:
{{- with $config.env }}
{{ toYaml . | indent 2 }}
{{- end }}

{{- with $config.files }}
{{ toYaml . | indent 2 }}
{{- end }}

{{- range $key, $value := $conifg.files_yaml }}
  {{ $key }}: |
{{ regexReplaceAll "(\\s+\\w+:\\s+)\\\\(\\!\\w+)" ( toYaml $value ) "${1}${2}" | indent 4 }}
{{- end }}

{{- end -}}
