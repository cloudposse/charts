{{- $root := . -}}
{{- $serviceName := include "common.fullname" . -}}
{{- range $name, $virtualService := .Values.virtualServices -}}
{{- if $virtualService.enabled }}
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
{{- with $virtualService.annotations }}
  annotations:
{{ toYaml . | indent 4 }}
{{- end }}
  labels:
{{- with $virtualService.labels }}
{{ toYaml . | indent 4 }}
{{- end }}
{{ include "common.labels.standard" $root | indent 4 }}
  name: {{ include "common.fullname" $root }}-{{ $name }}
spec:
{{- with $virtualService.hosts }}
  hosts:
{{ toYaml . | indent 4 }}
{{- end }}

{{- if gt ( len $virtualService.gateways ) 0 }}
{{- with $virtualService.gateways }}
  gateways:
{{ toYaml . | indent 4 }}
{{- end }}
{{- end }}

{{- if gt ( len $virtualService.http ) 0 }}
  http:
{{- range $http := $virtualServices.http -}}
  - {{ include "monochart.istio.virtualService.http" $http }}
{{- end }}
{{- end }}

{{- if gt ( len $virtualService.tls ) 0 }}
  tls:
{{- range $tls := $virtualServices.tls -}}
  - {{ include "monochart.istio.virtualService.tls" $tls }}
{{- end }}
{{- end }}

{{- if gt ( len $virtualService.tcp ) 0 }}
  tcp:
{{- range $tcp := $virtualServices.tcp -}}
  - {{ include "monochart.istio.virtualService.tcp" $tcp }}
{{- end }}
{{- end }}

{{- if gt ( len $virtualService.exportTo ) 0 }}
{{- with $virtualService.exportTo }}
  exportTo:
{{ toYaml . | indent 4 }}
{{- end }}
{{- end }}

{{- end -}}
{{- end -}}
