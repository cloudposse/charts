kind: Secret
apiVersion: v1
metadata:
  name: {{ template "fullname" . }}
  labels:
    chart: "{{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}"
data:
  config.yaml: |
    issuer: "http{{ if .Values.ingress.tls.enabled }}s{{end}}://{{ first .Values.ingress.hosts }}"

    storage:
      type: kubernetes
      config:
        inCluster: true
    web:
      http: 0.0.0.0:80

    connectors:
{{- if .Values.dex.github }}
    - type: github
      id: github
      name: "Github"
      config:
        clientID: {{ .Values.dex.github.clientID | quote }}
        clientSecret: {{ .Values.dex.github.clientSecret | quote }}
        redirectURI: {{ .Values.dex.issuer }}/callback
{{- end }}

{{- if .Values.dex.oidc }}
    - type: oidc
      id: {{ .Values.dex.oidc.id | quote }}
      name: "OIDC"
      config:
        issuer: {{ .Values.dex.oidc.issuer | quote }}
        clientID: {{ .Values.dex.oidc.clientID | quote }}
        clientSecret: {{ .Values.dex.oidc.clientSecret | quote }}
        redirectURI: {{ .Values.dex.issuer }}/callback
{{- end }}

    oauth2:
      skipApprovalScreen: true

    enablePasswordDB: true
    staticPassword:
    - email: {{ .Values.dex.staticPassword.email | quote }}
      hash: {{ .Values.dex.staticPassword.hash | quote }}
      username: {{ .Values.dex.staticPassword.username | quote }}
      userID: "08a8684b-db88-4b73-90a9-3cd1661f5466"