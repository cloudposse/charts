{{ if ( and .Values.ui.enabled .Values.ui.ssl.enabled ) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ template "fullname_proxy" . }}"
  labels:
    app: {{ template "fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
data:
  default.conf: |-
    server {
        listen 80 default_server;
        server_name  _;
        location / {
            proxy_pass          http://{{ template "openvpn_proxy_upstream" . }};
            proxy_set_header    Host $host;
            proxy_set_header    X-Real-IP $remote_addr;
            proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header    X-Forwarded-Proto $scheme;
            proxy_read_timeout  90;
        }
    }


{{end}}