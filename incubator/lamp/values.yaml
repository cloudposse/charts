# Default values for lamp.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

storage:
  name: wordpress-test
  size: 1Gi
  class: local-nfs

app:
  init:
    image:
      repository: cloudposse/init-wordpress
      tag: init
      pullPolicy: Always
    source: # k8s specific configs https://kubernetes.io/docs/user-guide/volumes/
      gitRepo:
        repository: "https://goruha:???@github.com/goruha/blog.git"
        revision: "dbcc6c47cf759cf83849e47c18784e33c814c27f"

    destination: # k8s specific configs https://kubernetes.io/docs/user-guide/volumes/
      persistentVolumeClaim:
        claimName: wordpress-test
    env:
      SOURCE: blog
      DB: "https://s3-us-west-1.amazonaws.com/cloudposse-blog/mysqldump.sql-20170207_081003.gz"
      DB_USER: root
      DB_NAME: wp

  config:
    name: wordpress-config
    value: |-
      define('DB_HOST', $MYSQL_DB_HOST);
      define('DOMAIN_CURRENT_SITE', 'a1a9d017deedb11e6918706d4c20806f-39169221.us-west-2.elb.amazonaws.com');



mysql:
  ## mysql image version
  ## ref: https://hub.docker.com/r/library/mysql/tags/
  ##
  imageTag: "5.7.14"

  ## Specify password for root user
  ##
  ## Default: random 10 character string
  # mysqlRootPassword: testing

  ## Create a database user
  ##
  mysqlUser: wp
  mysqlPassword: wp-password

  ## Allow unauthenticated access, uncomment to enable
  ##
  # mysqlAllowEmptyPassword: true

  ## Create a database
  ##
  mysqlDatabase: wp

  ## Specify an imagePullPolicy (Required)
  ## It's recommended to change this to 'Always' if the image tag is 'latest'
  ## ref: http://kubernetes.io/docs/user-guide/images/#updating-images
  ##
  imagePullPolicy: IfNotPresent

  ## Persist data to a persitent volume
  persistence:
    enabled: true
    ## If defined, volume.beta.kubernetes.io/storage-class: <storageClass>
    ## Default: volume.alpha.kubernetes.io/storage-class: default
    ##
    # storageClass:
    accessMode: ReadWriteOnce
    size: 8Gi

  ## Configure resource requests and limits
  ## ref: http://kubernetes.io/docs/user-guide/compute-resources/
  ##
  resources:
    requests:
      memory: 256Mi
      cpu: 100m

apache:
  replicaCount: 1
  env:
    APACHE_SERVER_NAME:                       localhost

    APACHE_WORKER_START_SERVERS:              2
    APACHE_WORKER_MIN_SPARE_THREADS:          2
    APACHE_WORKER_MAX_SPARE_THREADS:          10
    APACHE_WORKER_THREAD_LIMIT:               64
    APACHE_WORKER_THREADS_PER_CHILD:          25
    APACHE_WORKER_MAX_REQUEST_WORKERS:        4
    APACHE_WORKER_MAX_CONNECTIONS_PER_CHILD:  0

    APACHE_EVENT_START_SERVERS:             2
    APACHE_EVENT_MIN_SPARE_THREADS:         25
    APACHE_EVENT_MAX_SPARE_THREADS:         75
    APACHE_EVENT_THREAD_LIMIT:              64
    APACHE_EVENT_THREADS_PER_CHILD:         25
    APACHE_EVENT_MAX_REQUEST_WORKERS:       150
    APACHE_EVENT_MAX_CONNECTIONS_PER_CHILD: 0

    PHP_FPM_PM:                   ondemand
    PHP_FPM_MAX_CHILDREN:         10
    PHP_FPM_START_SERVERS:        1
    PHP_FPM_SPARE_SERVERS:        1
    PHP_FPM_MAX_SPARE_SERVERS:    10
    PHP_FPM_PROCESS_IDLE_TIMEOUT: 25s
    PHP_FPM_MAX_REQUESTS:         500

    DB_USER: wp
    DB_PASS: wp-password
    DB_NAME: wp
    DB_HOST: lamp-mysql

  mounts:
    data: # Volume name must match the regex [a-z0-9]([-a-z0-9]*[a-z0-9])? (e.g. 'my-name' or '123-abc')
      path: /var/www/html # Path
      volume: # k8s specific configs https://kubernetes.io/docs/user-guide/volumes/
        persistentVolumeClaim:
          claimName: wordpress-test
    config: # Volume name must match the regex [a-z0-9]([-a-z0-9]*[a-z0-9])? (e.g. 'my-name' or '123-abc')
      path: /var/www/html/wp-config.d # Path
      volume: # k8s specific configs https://kubernetes.io/docs/user-guide/volumes/
        configMap:
          name: wordpress-config

  image:
    repository: cloudposse/apache-php-fpm
    tag: latest
    pullPolicy: Always
  service:
    name: apache
    type: ClusterIP
    externalPort: 80
    internalPort: 80
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 100m
      memory: 128Mi


vps:
  vps:
    user: admin
    password:
    group: admin
    enableSudo: true
    githubUsers:
    envvars:
  mounts:
  ## Mounts
    data: # Volume name must match the regex [a-z0-9]([-a-z0-9]*[a-z0-9])? (e.g. 'my-name' or '123-abc')
      path: /data # Path
      volume: # k8s specific configs https://kubernetes.io/docs/user-guide/volumes/
        persistentVolumeClaim:
          claimName: wordpress-test
  image:
    repository: cloudposse/ubuntu-vps
    tag: latest
    pullPolicy: Always
  service:
    name: ssh
    type: ClusterIP
    externalPort: 22
    internalPort: 22
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 100m
      memory: 128Mi
